# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ iPay API v1.14

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –º–æ–¥—É–ª—å iPay –¥–ª—è OpenCart —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ iPay API v1.14](https://checkout.ipay.ua/doc).

## ‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [https://checkout.ipay.ua/doc](https://checkout.ipay.ua/doc)
- **–í–µ—Ä—Å–∏—è API**: v1.14 (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –Ω–∞ 2025-03-21)

### üìã –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

#### 1. **–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏**
–¢–æ—á–Ω–æ —Å–ª–µ–¥—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É:
```php
// –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ iPay API v1.14
$salt = sha1(microtime(true));
$sign = hash_hmac('sha512', $salt, $sign_key);
```

#### 2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ XML –∑–∞–ø—Ä–æ—Å–∞ PaymentCreate**
–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
```xml
<?xml version="1.0" encoding="utf-8"?>
<payment>
    <auth>
        <mch_id>ID –º–µ—Ä—á–∞–Ω—Ç–∞</mch_id>
        <salt>–°—ñ–ª—å –ø—ñ–¥–ø–∏—Å—É</salt>
        <sign>–ü—ñ–¥–ø–∏—Å –∑–∞–ø–∏—Ç—É</sign>
    </auth>
    <urls>
        <good>URL —É—Å–ø–µ—Ö–∞</good>
        <bad>URL –Ω–µ—É–¥–∞—á–∏</bad>
        <auto_redirect_good>1</auto_redirect_good>
        <auto_redirect_bad>1</auto_redirect_bad>
        <retry_button>1</retry_button>
        <cancel_button>1</cancel_button>
    </urls>
    <transactions>
        <transaction>
            <amount>–°—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö</amount>
            <currency>–í–∞–ª—é—Ç–∞</currency>
            <desc>–û–ø–∏—Å–∞–Ω–∏–µ</desc>
            <info>{"order_id":123}</info>
        </transaction>
    </transactions>
    <lifetime>24</lifetime>
    <lang>ru/ua/en</lang>
</payment>
```

#### 3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ callback –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
```xml
<?xml version="1.0" encoding="utf-8"?>
<payment ident="WGUID">
    <status>1-5</status>
    <amount>–°—É–º–º–∞</amount>
    <currency>UAH/USD/EUR</currency>
    <timestamp>UNIX timestamp</timestamp>
    <transactions>
        <transaction tid="ID">
            <mch_id>ID –º–µ—Ä—á–∞–Ω—Ç–∞</mch_id>
            <smch_id>–Æ—Ä. –ª–∏—Ü–æ</smch_id>
            <invoice>–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞</invoice>
            <amount>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ</amount>
            <desc>–û–ø–∏—Å–∞–Ω–∏–µ</desc>
            <info>{"order_id":123}</info>
        </transaction>
    </transactions>
    <auth>
        <salt>–°–æ–ª—å</salt>
        <sign>–ü–æ–¥–ø–∏—Å—å</sign>
    </auth>
    <payment_type>Manual/GooglePay/ApplePay</payment_type>
</payment>
```

#### 4. **URL –∞–¥—Ä–µ—Å–∞ API**
- **Production**: `https://checkout.ipay.ua/api302`
- **Sandbox**: `https://sandbox-checkout.ipay.ua/api302`

#### 5. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã**
- UAH (–æ—Å–Ω–æ–≤–Ω–∞—è)
- USD 
- EUR

#### 6. **–°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π**
–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- `1` - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- `3` - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `4` - –ù–µ—É—Å–ø–µ—à–Ω—ã–π
- `5` - –£—Å–ø–µ—à–Ω—ã–π

#### 7. **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ API v1.14**
- ‚úÖ `auto_redirect_good` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- ‚úÖ `auto_redirect_bad` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
- ‚úÖ `retry_button` - –∫–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞ –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ `cancel_button` - –∫–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã
- ‚úÖ `payment_type` - —Ç–∏–ø –ø–ª–∞—Ç–µ–∂–∞ –≤ callback

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 1. **HTTPS —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π HTTPS –¥–ª—è production callback'–æ–≤
- SSL –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `hash_equals()` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É

#### 3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ Merchant ID (—á–∏—Å–ª–æ–≤–æ–π)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞ (32 —Å–∏–º–≤–æ–ª–∞)
- –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ XML –¥–∞–Ω–Ω—ã—Ö

### üß™ Sandbox —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã (—Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏):
**–£—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏:**
- 3333333333333331
- 3333333333332705
- 5375913862726080

**–£—Å–ª–æ–≤–Ω–æ —É—Å–ø–µ—à–Ω—ã–µ (–¥–æ 100 –≥—Ä–Ω):**
- 3333333333333430
- 5117962099480048

**–ù–µ—É—Å–ø–µ—à–Ω—ã–µ:**
- 3333333333333349
- 4280596505234682

**–ü—Ä–µ–¥–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- 3333333333333356

### üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º debug —Ä–µ–∂–∏–º–µ:
```php
const IPAY_DEBUG_MODE = true;
```

–õ–æ–≥–∏—Ä—É–µ—Ç—Å—è:
- –ò—Å—Ö–æ–¥—è—â–∏–µ XML –∑–∞–ø—Ä–æ—Å—ã
- –í—Ö–æ–¥—è—â–∏–µ callback —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- cURL verbose –ª–æ–≥–∏
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ iPay

1. **Callback URL**: `https://your-site.com/index.php?route=extension/payment/ipay/callback`
2. **–§–æ—Ä–º–∞—Ç**: XML
3. **–ú–µ—Ç–æ–¥**: POST
4. **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8

### üìà –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

| –í–µ—Ä—Å–∏—è –º–æ–¥—É–ª—è | –í–µ—Ä—Å–∏—è API | –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|---------------|------------|------------|-----------|
| 1.0.0         | 3.02       | 2024       | –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
| 2.0.0         | v1.14      | 2025-01-25 | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ |

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –¢–∞–π–º–∞—É—Ç—ã: 10 —Å–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, 30 —Å–µ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –û—Ç–∫–ª—é—á–µ–Ω CURLOPT_FOLLOWLOCATION –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- User-Agent: `OpenCart-iPay-Module/2.0`

### üåç –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
- `ru` - —Ä—É—Å—Å–∫–∏–π
- `ua` - —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π  
- `en` - –∞–Ω–≥–ª–∏–π—Å–∫–∏–π

### üìù Changelog

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:
- Conventional Commits
- Semantic Versioning
- –î–µ—Ç–∞–ª—å–Ω—ã–π CHANGELOG.md

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: –ú–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ iPay API v1.14 –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ –Ω–µ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.